<!DOCTYPE html>
<html>
<head>
    <title>Test Registration Form - Middle Name Optional</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { border: 1px solid #ccc; padding: 20px; margin: 10px 0; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
    </style>
</head>
<body>
    <h1>Registration Form Test - Middle Name Should Be Optional</h1>
    
    <div class="test-section">
        <h2>Test Results:</h2>
        <div id="test-results"></div>
    </div>

    <script>
        // Simulate the JavaScript functions from the registration form
        let selectedRole = 'student';

        function showStudentFields() {
            // This should include student_middle_name in the array but NOT make it required
            const studentFields = [
                'student_first_name', 'student_middle_name', 'student_last_name',
                'student_email', 'student_phone', 'student_id', 'course_category', 'year_level',
                'student_password', 'student_password_confirmation'
            ];
            
            console.log('Student fields that will be enabled:', studentFields);
            
            // Check if middle_name and name_extension are in the array (they should be)
            const hasMiddleName = studentFields.includes('student_middle_name');
            const hasNameExtension = studentFields.includes('student_name_extension');
            
            // Simulate the JavaScript logic - check if they would be made required
            const middleNameRequired = hasMiddleName; // Would be made required in old version
            const nameExtensionRequired = hasNameExtension; // Would be made required in old version
            
            // After fix: middle name and name extension should NOT be required
            const middleNameActuallyRequired = false; // Fixed version
            const nameExtensionActuallyRequired = false; // Already was false
            
            if (hasMiddleName && hasNameExtension && !middleNameActuallyRequired && !nameExtensionActuallyRequired) {
                console.log('SUCCESS: student_middle_name and student_name_extension are included but NOT made required');
                return {
                    middleNameIncluded: true,
                    nameExtensionIncluded: true,
                    middleNameRequired: false,
                    nameExtensionRequired: false,
                    result: true
                };
            } else {
                console.error('ERROR: student_middle_name and student_name_extension should be included but not required!');
                return {
                    middleNameIncluded: hasMiddleName,
                    nameExtensionIncluded: hasNameExtension,
                    middleNameRequired: middleNameActuallyRequired,
                    nameExtensionRequired: nameExtensionActuallyRequired,
                    result: false
                };
            }
        }

        function showFacultyStaffFields(type) {
            // Simulate the logic: fs-input fields are processed, but middle_name and name_extension are excluded from required
            const fsInputs = ['fs_first_name', 'fs_middle_name', 'fs_last_name', 'fs_email', 'fs_phone', 'fs_password', 'fs_password_confirmation'];
            const excludedFields = ['middle_name', 'name_extension'];
            
            console.log('Faculty/Staff inputs that will be processed:', fsInputs);
            
            // Check if middle_name is properly excluded from required
            const middleNameExcluded = excludedFields.includes('middle_name');
            const nameExtensionExcluded = excludedFields.includes('name_extension');
            
            if (middleNameExcluded && nameExtensionExcluded) {
                console.log('SUCCESS: Both middle_name and name_extension are correctly excluded for faculty/staff');
                return { 
                    middleNameExcluded: true, 
                    nameExtensionExcluded: true,
                    result: true 
                };
            } else {
                console.error('ERROR: Both middle_name and name_extension should be excluded for faculty/staff!');
                return { 
                    middleNameExcluded: middleNameExcluded, 
                    nameExtensionExcluded: nameExtensionExcluded,
                    result: false 
                };
            }
        }

        // Test the frontend HTML structure
        function testFrontendStructure() {
            // Simulate checking the actual HTML structure
            const studentMiddleNameRequired = false; // Should be false - no required attribute
            const facultyMiddleNameRequired = false; // Should be false - no required attribute
            
            if (!studentMiddleNameRequired && !facultyMiddleNameRequired) {
                console.log('SUCCESS: Frontend HTML has no required attribute on middle name fields');
                return true;
            } else {
                console.error('ERROR: Middle name fields should not have required attribute');
                return false;
            }
        }

        // Test the backend validation
        function testBackendValidation() {
            // Simulate checking the Laravel validation rules
            const middleNameValidation = ['nullable', 'string', 'max:255']; // This is what we found in the controller
            const isNullable = middleNameValidation.includes('nullable');
            
            if (isNullable) {
                console.log('SUCCESS: Backend validation uses nullable rule for middle_name');
                return true;
            } else {
                console.error('ERROR: Backend validation should use nullable rule');
                return false;
            }
        }

        // Run all tests
        function runTests() {
            const results = document.getElementById('test-results');
            let html = '';
            
            // Test 1: Student fields logic
            const studentTest = showStudentFields();
            html += `<div class="${studentTest.result ? 'success' : 'error'}">`;
            html += `Student Fields Logic: ${studentTest.result ? '‚úì PASS' : '‚úó FAIL'}`;
            if (!studentTest.middleNameIncluded) {
                html += ' - Middle name field missing from student fields';
            }
            if (studentTest.middleNameRequired) {
                html += ' - Middle name should not be required';
            }
            if (!studentTest.nameExtensionIncluded) {
                html += ' - Name extension field missing from student fields';
            }
            if (studentTest.nameExtensionRequired) {
                html += ' - Name extension should not be required';
            }
            html += `</div>`;
            
            // Test 2: Faculty/Staff fields logic  
            const facultyTest = showFacultyStaffFields('faculty');
            html += `<div class="${facultyTest.result ? 'success' : 'error'}">`;
            html += `Faculty/Staff Fields Logic: ${facultyTest.result ? '‚úì PASS' : '‚úó FAIL'}`;
            if (!facultyTest.middleNameExcluded) {
                html += ' - Middle name should be excluded from required';
            }
            if (!facultyTest.nameExtensionExcluded) {
                html += ' - Name extension should be excluded from required';
            }
            html += `</div>`;
            
            // Test 3: Frontend HTML structure
            const frontendTest = testFrontendStructure();
            html += `<div class="${frontendTest ? 'success' : 'error'}">`;
            html += `Frontend HTML Structure: ${frontendTest ? '‚úì PASS' : '‚úó FAIL'} - ${frontendTest ? 'No required attribute on middle name fields' : 'Middle name fields incorrectly marked as required'}`;
            html += `</div>`;
            
            // Test 4: Backend validation
            const backendTest = testBackendValidation();
            html += `<div class="${backendTest ? 'success' : 'error'}">`;
            html += `Backend Validation: ${backendTest ? '‚úì PASS' : '‚úó FAIL'} - ${backendTest ? 'Uses nullable validation rule' : 'Should use nullable validation rule'}`;
            html += `</div>`;
            
            // Summary
            const allPassed = studentTest.result && facultyTest.result && frontendTest && backendTest;
            html += `<div class="test-section">`;
            html += `<h3>Overall Result:</h3>`;
            html += `<div class="${allPassed ? 'success' : 'error'}">`;
            html += allPassed ? 
                'üéâ ALL TESTS PASSED - Middle name is now properly optional for all user types!' : 
                '‚ùå SOME TESTS FAILED - Middle name field may still be required in some cases';
            html += `</div>`;
            
            // Additional info
            html += `<div class="info">`;
            html += `<h4>Implementation Details:</h4>`;
            html += `<ul>`;
            html += `<li><strong>Frontend:</strong> Label shows "(optional)" and no required attribute</li>`;
            html += `<li><strong>Backend:</strong> Validation uses 'nullable' rule</li>`;
            html += `<li><strong>JavaScript:</strong> Excludes middle_name from required field logic</li>`;
            html += `</ul>`;
            html += `</div>`;
            
            html += `</div>`;
            
            results.innerHTML = html;
        }

        // Run tests when page loads
        runTests();
    </script>
</body>
</html>